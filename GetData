# coding: utf-8
import urllib2
from bs4 import BeautifulSoup
import numpy as np
import matplotlib.pyplot as plt

#code = u"998407.o"
code = u"9024.T"
url = u"http://m.finance.yahoo.co.jp/stock/historicaldata?code=" +code
#url = u"http://stocks.finance.yahoo.co.jp/stocks/detail/?code=" + code
#http://m.finance.yahoo.co.jp/stock/historicaldata?code=9024.T&fy=2016&fm=5&fd=8&ty=2016&tm=6&td=8&cp=d

html = urllib2.urlopen(url)
soup = BeautifulSoup(html, "html")
#print(soup)
# 株価を取得
# td class="stoksPrice"を検索

dateIndex = 0
elementIndex =0
elementNumber = 9
stockHistoryData = np.zeros([20,elementNumber])  #配列の宣言

"""
配列の説明
0:年
1:月
2:日
3:始値	
4:高値
5:安値
6:終値	
7:出来高
8:調整後終値
"""
for price in soup.find_all("table",class_="tableFin"):		#elementclint = 0
	for priceTable in price.find_all("td"):			
			#日付をスライスで三つに分割する
			if elementIndex < 3:
				print(priceTable.string.split("/"))
				for i in priceTable.string.split("/"):
					print(i)
					stockHistoryData[dateIndex,elementIndex] = i
					elementIndex +=1
			else:
				fixedElement = int(priceTable.string.replace(",",""))	
				print(fixedElement) #ここは出力される。
				# elementclint +=1				
				stockHistoryData[dateIndex,elementIndex] = fixedElement
				elementIndex +=1			
			#print(stockHistoryData[dateIndex,elementIndex]	)	
			if elementIndex ==9:
				dateIndex +=1
				elementIndex = 0
#return stockHistoryData			

"""				
averageDates=5
getAverage = np.zeros(averageDates)		

for i in range(0,averageDates):
	print stockHistoryData[i,6]
	getAverage[i] = stockHistoryData[i,6]

print "Average is " 
print np.mean(getAverage)

#x = np.arange(1500,2500, 50)
#plt.plot(x, getAverage)
"""
"""
for i in getaverage:
	plt.plot()
"""	
"""			
	print stockHistoryData	[1,1]
	print stockHistoryData.flags
	print stockHistoryData.ndim
	print stockHistoryData.size
	print stockHistoryData.dtype		
	print stockHistoryData
	print(len(priceTable))
	print "element are" + str(elementclint/7)
			#stockHistoryData 
			
"""				
		
"""		result = str(price)
		print(result)
		print("Cannot find anything")
"""
